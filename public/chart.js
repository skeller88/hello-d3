var singleGroupData = {
    "top_treatments": [
        {
            "_id": {
                "treatment": "Vitamin d"
            },
            "count": 50
        },
        {
            "_id": {
                "treatment": "Exercise"
            },
            "count": 45
        },
        {
            "_id": {
                "treatment": "Magnesium"
            },
            "count": 38
        },
        {
            "_id": {
                "treatment": "Ibuprofen"
            },
            "count": 37
        },
        {
            "_id": {
                "treatment": "gluten free"
            },
            "count": 28
        },
        {
            "_id": {
                "treatment": "Meditation"
            },
            "count": 27
        },
        {
            "_id": {
                "treatment": "Gabapentin"
            },
            "count": 26
        },
        {
            "_id": {
                "treatment": "dairy free"
            },
            "count": 24
        },
        {
            "_id": {
                "treatment": "Yoga"
            },
            "count": 23
        },
        {
            "_id": {
                "treatment": "Fish oil"
            },
            "count": 22
        }
    ],
    "n_symptoms": [
        {
            "_id": 1,
            "count": 204
        },
        {
            "_id": 2,
            "count": 149
        },
        {
            "_id": 3,
            "count": 50
        },
        {
            "_id": 4,
            "count": 19
        },
        {
            "_id": 5,
            "count": 22
        },
        {
            "_id": 6,
            "count": 16
        },
        {
            "_id": 7,
            "count": 10
        },
        {
            "_id": 8,
            "count": 5
        },
        {
            "_id": 9,
            "count": 4
        },
        {
            "_id": 10,
            "count": 3
        },
        {
            "_id": 11,
            "count": 3
        },
        {
            "_id": 13,
            "count": 1
        },
        {
            "_id": 15,
            "count": 2
        },
        {
            "_id": 17,
            "count": 1
        },
        {
            "_id": 18,
            "count": 1
        },
        {
            "_id": 27,
            "count": 1
        },
        {
            "_id": 46,
            "count": 1
        }
    ],
    "top_symptoms": [
        {
            "_id": {
                "symptom": "Fatigue"
            },
            "count": 281
        },
        {
            "_id": {
                "symptom": "Headache"
            },
            "count": 122
        },
        {
            "_id": {
                "symptom": "Anxiety"
            },
            "count": 97
        },
        {
            "_id": {
                "symptom": "Brain fog"
            },
            "count": 97
        },
        {
            "_id": {
                "symptom": "Joint pain"
            },
            "count": 90
        },
        {
            "_id": {
                "symptom": "Pain"
            },
            "count": 83
        },
        {
            "_id": {
                "symptom": "Diarrhea"
            },
            "count": 80
        },
        {
            "_id": {
                "symptom": "Nausea"
            },
            "count": 80
        },
        {
            "_id": {
                "symptom": "Depression"
            },
            "count": 78
        },
        {
            "_id": {
                "symptom": "Dizziness"
            },
            "count": 55
        }
    ],
    "n_conditions": [
        {
            "_id": 1,
            "count": 350
        },
        {
            "_id": 2,
            "count": 75
        },
        {
            "_id": 3,
            "count": 28
        },
        {
            "_id": 4,
            "count": 20
        },
        {
            "_id": 5,
            "count": 7
        },
        {
            "_id": 6,
            "count": 4
        },
        {
            "_id": 7,
            "count": 4
        },
        {
            "_id": 8,
            "count": 1
        },
        {
            "_id": 9,
            "count": 3
        }
    ],
    "top_conditions": [
        {
            "_id": {
                "condition": "Depression"
            },
            "count": 96
        },
        {
            "_id": {
                "condition": "Fibromyalgia"
            },
            "count": 84
        },
        {
            "_id": {
                "condition": "Anxiety"
            },
            "count": 80
        },
        {
            "_id": {
                "condition": "Migraine"
            },
            "count": 53
        },
        {
            "_id": {
                "condition": "Chronic fatigue syndrome"
            },
            "count": 46
        },
        {
            "_id": {
                "condition": "Ehlers-Danlos syndrome"
            },
            "count": 44
        },
        {
            "_id": {
                "condition": "Irritable bowel syndrome"
            },
            "count": 37
        },
        {
            "_id": {
                "condition": "Crohn's disease"
            },
            "count": 34
        },
        {
            "_id": {
                "condition": "Asthma"
            },
            "count": 32
        },
        {
            "_id": {
                "condition": "Hashimoto's disease"
            },
            "count": 27
        }
    ],
    "n_users": 492,
    "n_treatments": [
        {
            "_id": 1,
            "count": 254
        },
        {
            "_id": 2,
            "count": 72
        },
        {
            "_id": 3,
            "count": 37
        },
        {
            "_id": 4,
            "count": 14
        },
        {
            "_id": 5,
            "count": 17
        },
        {
            "_id": 6,
            "count": 12
        },
        {
            "_id": 7,
            "count": 8
        },
        {
            "_id": 8,
            "count": 9
        },
        {
            "_id": 9,
            "count": 9
        },
        {
            "_id": 10,
            "count": 4
        },
        {
            "_id": 11,
            "count": 6
        },
        {
            "_id": 12,
            "count": 2
        },
        {
            "_id": 13,
            "count": 1
        },
        {
            "_id": 14,
            "count": 3
        },
        {
            "_id": 15,
            "count": 3
        },
        {
            "_id": 16,
            "count": 1
        },
        {
            "_id": 17,
            "count": 3
        },
        {
            "_id": 18,
            "count": 2
        },
        {
            "_id": 19,
            "count": 1
        },
        {
            "_id": 20,
            "count": 2
        },
        {
            "_id": 21,
            "count": 1
        },
        {
            "_id": 22,
            "count": 1
        },
        {
            "_id": 23,
            "count": 2
        },
        {
            "_id": 25,
            "count": 3
        },
        {
            "_id": 27,
            "count": 1
        },
        {
            "_id": 28,
            "count": 1
        },
        {
            "_id": 29,
            "count": 1
        },
        {
            "_id": 30,
            "count": 1
        },
        {
            "_id": 33,
            "count": 1
        },
        {
            "_id": 34,
            "count": 1
        },
        {
            "_id": 36,
            "count": 3
        },
        {
            "_id": 39,
            "count": 1
        },
        {
            "_id": 40,
            "count": 1
        },
        {
            "_id": 43,
            "count": 2
        },
        {
            "_id": 49,
            "count": 1
        },
        {
            "_id": 52,
            "count": 1
        },
        {
            "_id": 54,
            "count": 1
        },
        {
            "_id": 56,
            "count": 1
        },
        {
            "_id": 66,
            "count": 1
        },
        {
            "_id": 69,
            "count": 1
        },
        {
            "_id": 71,
            "count": 1
        },
        {
            "_id": 75,
            "count": 1
        },
        {
            "_id": 80,
            "count": 1
        },
        {
            "_id": 86,
            "count": 1
        },
        {
            "_id": 88,
            "count": 1
        },
        {
            "_id": 118,
            "count": 1
        }
    ]
};

var segmentedData = [
    {
        "top_conditions": [
            {
                "groupBy": {"sex": "male"},
                "values": [
                    {"_id": "depression", "count": 108},
                    {"_id": "fibromyalgia", "count": 99},
                    {"_id": "anxiety", "count": 87},
                    {"_id": "migraine", "count": 81},
                    {"_id": "chronic fatigue syndrome", "count": 75},
                    {"_id": "ehlers-danlos syndrome", "count": 70},
                    {"_id": "irritable bowel syndrome", "count": 68},
                    {"_id": "crohn's disease", "count": 61},
                    {"_id": "asthma", "count": 58},
                    {"_id": "hashimoto's thyroiditis", "count": 55}
                ]
            },
            {
                "groupBy": {"sex": "female"},
                "values": [
                    {"_id": "depression", "count": 158},
                    {"_id": "fibromyalgia", "count": 148},
                    {"_id": "migraine", "count": 140},
                    {"_id": "anxiety", "count": 135},
                    {"_id": "chronic fatigue syndrome", "count": 130},
                    {"_id": "ehlers-danlos syndrome", "count": 121},
                    {"_id": "crohn's disease", "count": 104},
                    {"_id": "irritable bowel syndrome", "count": 95},
                    {"_id": "hashimoto's thyroiditis", "count": 91},
                    {"_id": "hypothyroidism", "count": 88}
                ]
            }
        ]
    },
    {
        "n_conditions": [
            {
                "groupBy": {"sex": "male"},
                "values": [
                    {"_id": 0,  "count": 56},
                    {"_id": 1,  "count": 101},
                    {"_id": 2,  "count": 154},
                    {"_id": 3,  "count": 132},
                    {"_id": 4,  "count": 89},
                    {"_id": 5,  "count": 65},
                    {"_id": 6,  "count": 45},
                    {"_id": 7,  "count": 30},
                    {"_id": 8,  "count": 21},
                    {"_id": 9,  "count": 15},
                    {"_id": 10, "count": 5},
                    {"_id": 11, "count": 3},
                    {"_id": 12, "count": 2},
                    {"_id": 14, "count": 1},
                    {"_id": 19, "count": 1}
                ]
            },
            {
                "groupBy": {"sex": "female"},
                "values": [
                    {"_id": 0,  "count": 84},
                    {"_id": 1,  "count": 161},
                    {"_id": 2,  "count": 144},
                    {"_id": 3,  "count": 162},
                    {"_id": 4,  "count": 101},
                    {"_id": 5,  "count": 85},
                    {"_id": 6,  "count": 55},
                    {"_id": 7,  "count": 51},
                    {"_id": 8,  "count": 41},
                    {"_id": 9,  "count": 20},
                    {"_id": 10, "count": 14},
                    {"_id": 11, "count": 10},
                    {"_id": 12, "count": 6},
                    {"_id": 13, "count": 2},
                    {"_id": 14, "count": 1},
                    {"_id": 18, "count": 1},
                    {"_id": 21, "count": 1},
                    {"_id": 25, "count": 1}
                ]
            }
        ]
    },
    {
        "top_symptoms": [
            {
                "groupBy": {"sex": "male"},
                "values": [
                    {"_id": "fatigue", "count": 178},
                    {"_id": "headache", "count": 102},
                    {"_id": "brain fog", "count": 81},
                    {"_id": "anxiety", "count": 78},
                    {"_id": "joint pain", "count": 71},
                    {"_id": "pain", "count": 65},
                    {"_id": "nausea", "count": 60},
                    {"_id": "diarrhea", "count": 58},
                    {"_id": "depression", "count": 51},
                    {"_id": "dizziness", "count": 50}
                ]
            },
            {
                "groupBy": {"sex": "female"},
                "values": [
                    {"_id": "fatigue", "count": 178},
                    {"_id": "headache", "count": 102},
                    {"_id": "brain fog", "count": 81},
                    {"_id": "pain", "count": 78},
                    {"_id": "joint pain", "count": 71},
                    {"_id": "anxiety", "count": 65},
                    {"_id": "nausea", "count": 60},
                    {"_id": "diarrhea", "count": 58},
                    {"_id": "depression", "count": 51},
                    {"_id": "dizziness", "count": 50}
                ]
            }
        ]
    },
    {
        "n_symptoms": [
            {
                "groupBy": {"sex": "male"},
                "values": [
                    {"_id": 0,  "count": 30},
                    {"_id": 1,  "count": 151},
                    {"_id": 2,  "count": 144},
                    {"_id": 3,  "count": 110},
                    {"_id": 4,  "count": 88},
                    {"_id": 5,  "count": 63},
                    {"_id": 6,  "count": 40},
                    {"_id": 7,  "count": 32},
                    {"_id": 8,  "count": 21},
                    {"_id": 9,  "count": 15},
                    {"_id": 10, "count": 5},
                    {"_id": 12, "count": 2},
                    {"_id": 14, "count": 1},
                    {"_id": 16, "count": 1},
                    {"_id": 25, "count": 1}
                ]
            },
            {
                "groupBy": {"sex": "female"},
                "values": [
                    {"_id": 0,  "count": 44},
                    {"_id": 1,  "count": 131},
                    {"_id": 2,  "count": 184},
                    {"_id": 3,  "count": 202},
                    {"_id": 4,  "count": 141},
                    {"_id": 5,  "count": 89},
                    {"_id": 6,  "count": 54},
                    {"_id": 7,  "count": 52},
                    {"_id": 8,  "count": 41},
                    {"_id": 9,  "count": 20},
                    {"_id": 10, "count": 14},
                    {"_id": 11, "count": 10},
                    {"_id": 12, "count": 6},
                    {"_id": 13, "count": 2},
                    {"_id": 18, "count": 1},
                    {"_id": 21, "count": 1},
                    {"_id": 25, "count": 1},
                    {"_id": 27, "count": 1},
                    {"_id": 35, "count": 1}
                ]
            }
        ]
    },
    {
        "top_treatments": [
            {
                "groupBy": {"sex": "male"},
                "values": [
                    {"_id": "exercise", "count": 75},
                    {"_id": "magnesium", "count": 69},
                    {"_id": "vitamin d", "count": 61},
                    {"_id": "ibuprofen", "count": 57},
                    {"_id": "gluten free", "count": 53},
                    {"_id": "yoga", "count": 53},
                    {"_id": "dairy free", "count": 51},
                    {"_id": "sleep", "count": 46},
                    {"_id": "fish oil", "count": 45},
                    {"_id": "gabapentin", "count": 41}
                ]
            },
            {
                "groupBy": {"sex": "female"},
                "values": [
                    {"_id": "vitamin d", "count": 91},
                    {"_id": "exercise", "count": 88},
                    {"_id": "magnesium", "count": 85},
                    {"_id": "ibuprofen", "count": 81},
                    {"_id": "meditation", "count": 71},
                    {"_id": "gluten free", "count": 66},
                    {"_id": "dairy free", "count": 50},
                    {"_id": "yoga", "count": 48},
                    {"_id": "fish oil", "count": 45},
                    {"_id": "sleep", "count": 44}
                ]
            }
        ]
    },
    {
        "n_treatments": [
            {
                "groupBy": {"sex": "male"},
                "values": [
                    {"_id": 0,  "count": 78},
                    {"_id": 1,  "count": 131},
                    {"_id": 2,  "count": 155},
                    {"_id": 3,  "count": 112},
                    {"_id": 4,  "count": 80},
                    {"_id": 5,  "count": 64},
                    {"_id": 6,  "count": 42},
                    {"_id": 7,  "count": 31},
                    {"_id": 8,  "count": 23},
                    {"_id": 9,  "count": 15},
                    {"_id": 10, "count": 3},
                    {"_id": 11, "count": 5},
                    {"_id": 12, "count": 2},
                    {"_id": 15, "count": 1},
                    {"_id": 19, "count": 1},
                    {"_id": 30, "count": 1}
                ]
            },
            {
                "groupBy": {"sex": "female"},
                "values": [
                    {"_id": 0,  "count": 94},
                    {"_id": 1,  "count": 201},
                    {"_id": 2,  "count": 124},
                    {"_id": 3,  "count": 112},
                    {"_id": 4,  "count": 105},
                    {"_id": 5,  "count": 81},
                    {"_id": 6,  "count": 58},
                    {"_id": 7,  "count": 51},
                    {"_id": 8,  "count": 43},
                    {"_id": 9,  "count": 19},
                    {"_id": 10, "count": 14},
                    {"_id": 11, "count": 5},
                    {"_id": 12, "count": 3},
                    {"_id": 13, "count": 2},
                    {"_id": 14, "count": 1},
                    {"_id": 18, "count": 1},
                    {"_id": 21, "count": 1},
                    {"_id": 25, "count": 1},
                    {"_id": 47, "count": 1}
                ]
            }
        ]
    }
];


// Chart settings
var width = 446;
var height = 333;
var outerMargin = {
    top: 10,
    right: 30,
    bottom: 35,
    left: 40
};
var axisLabelMargin = {
    x: 10,
    y: 3
}
var chartTitleMargin = 5;
var innerWidth = width - outerMargin.left - outerMargin.right;
var innerHeight = height - outerMargin.top - outerMargin.bottom;


/**
 *
 * @param rawData
 * @param category {string} "n_symptoms"
 * @param binSize
 */
function chartSingleGroupCounts(rawData, category, binSize) {
    var mungedData = mungeData(rawData, category);
    var binSize = binSize || 2;
    var chartOptions = {
        binSize: binSize,
        chartTypeName: mungedData.chartTypeName
    };

    var data = mungedData.data;
    var keys = Object.keys(data);

    // keys of data, "_id"s, are the "number of conditions/symptoms/treatments". The value type is String.
    var extent = d3.extent(Object.keys(data), function(d) {
        return parseInt(d);
    });
    var min = extent[0];
    // histograms in R hist() are left-open and right-closed by default.
    var max = extent[1];

    drawHistogramChart(data, max, min, chartOptions);
}

/**
 * Chart difference between two groups in counts of symptoms, conditions, or treatments.
 * @param rawData {object} the two groups of data wrapped in an object
 * @param field {string} 'sex', 'age'
 * @param baselineName {string} baseline group name
 * @param comparisonName {string} group to compare against baseline
 * @param binSize {int} size of histogram bin
 */
function chartBetweenGroupCounts(rawData, field, baselineName, comparisonName, binSize) {
    console.log('Comparing', comparisonName, 'against', baselineName, 'baseline');

    var mungedData = mungeSegmentedData(rawData, field, baselineName, comparisonName);
    var diffDataRecord = computeGroupDifferences(mungedData.baselineData, mungedData.comparisonData);
    var binSize = binSize || 2;
    var chartOptions = {
        binSize: binSize,
        chartTypeName: mungedData.chartTypeName
    };

    var totalData = mungedData.baselineData.concat(mungedData.comparisonData);

    // keys of diffDataRecord, "_id"s, are the "number of conditions/symptoms/treatments". The value type is String.
    var extent = d3.extent(Object.keys(totalData), function(d) {
        return parseInt(d);
    });
    var min = extent[0];
    // histograms in R hist() are left-open and right-closed by default.
    var max = extent[1];

    drawHistogramChart(diffDataRecord, max, min, chartOptions);
}

/**
 *
 * @param dataObj - {'top_conditions':[], 'n_conditions':[], ...}
 * @returns string
 */
function getChartType(dataObj) {
    var chartTypes = [
        'n_conditions',
        'n_symptoms',
        'n_treatments'
    ];

    for (var i = 0; i < chartTypes.length; i++) {
        if (dataObj[chartTypes[i]] != undefined) {
            return chartTypes[i];
        }
    }
    return null;
}

function getChartName(chartType) {
    var chartTypeToNameMap = {
        'n_conditions': 'conditions',
        'n_symptoms': 'symptoms',
        'n_treatments': 'treatments'
    };

    return chartTypeToNameMap[chartType];
}

/**
 * @param dataObj {object}
 *  {'top_conditions: [
 *      {"groupBy": {"sex": "female"},
 *      "values": [{"_id": 0,  "count": 94}, ...]
 *  }], ...}
 *  @param category {string}
 *  @returns {object} {data: {1: 30, 2: 40}}
 */
function mungeData(dataObj, category) {
    if (!dataObj[category]) {
        console.error('No data for category', category);
        return;
    }

    var chartTypeName = getChartName(category);

    var dataRecord = {};

    dataObj[category].forEach(function(el) {
        dataRecord[el._id] = el.count;
    });

    return {
        data: dataRecord,
        chartTypeName: chartTypeName
    };
}

/**
 *
 * @param dataObj -
 *  {'top_conditions: [
 *      {"groupBy": {"sex": "female"},
 *      "values": [{"_id": 0,  "count": 94}, ...]
 *  }], ...}
 * @param field
 * @param baselineName
 * @param comparisonName
 * @returns {{baselineData: (*|values|fixture.values|data.values), comparisonData: (*|values|fixture.values|data.values), chartTypeName: *}}
 */
function mungeSegmentedData(dataObj, field, baselineName, comparisonName) {
    // look up the proper key in data
    var chartType = getChartType(dataObj);
    // populate chart title and x axis
    var chartTypeName = getChartName(chartType);
    var data = dataObj[chartType];
    var firstGroupName = data[0].groupBy[field];
    var secondGroupName = data[1].groupBy[field];

    if (firstGroupName === baselineName && secondGroupName === comparisonName) {
        var baselineData = data[0].values;
        var comparisonData = data[1].values;
    } else if (firstGroupName === comparisonName && secondGroupName === baselineName) {
        var baselineData = data[1].values;
        var comparisonData = data[0].values;
    } else {
        console.error('Expected baseline group name and comparison group name do not match the data\'s group names.');
    }

    return {
        baselineData: baselineData,
        comparisonData: comparisonData,
        chartTypeName: chartTypeName
    }
}

/**
 *
 * @param baselineData
 * @param comparisonData
 * @returns {{}} differences between groups at each count level, example: {1: -30, 2: 20, 3: -100, 4: 0}
 */
function computeGroupDifferences(baselineData, comparisonData) {
    // Munge to compute diffs
    // {1 : 300, 2: 30, 4: 50}
    var diffDataRecord = {};
    comparisonData.forEach(function(obj) {
        diffDataRecord[obj._id] = obj.count;
    });

    // {1: -30, 2: 20, 3: -100, 4: 0}
    baselineData.forEach(function(obj) {
        var comparisonCount = diffDataRecord[obj._id];

        if (comparisonCount === undefined) {
            console.warn('Found baseline _id with no matching comparison _id:', obj._id);
            diffDataRecord[obj._id] = 0 - obj.count;
        } else {
            diffDataRecord[obj._id] = comparisonCount - obj.count;
        }
    });

    return diffDataRecord;
}

/**
 *
 * @param data {object} {1: -30, 2: 20, 3: -100, 4: 0}
 * @param max
 * @param min
 * @param chartOptions
 */
function drawHistogramChart(data, max, min, chartOptions) {
    // Chart options
    var binSize = chartOptions.binSize || 2;
    var title = 'Number of ' + chartOptions.chartTypeName;
    var xLabel = 'Number of ' + chartOptions.chartTypeName;
    var yLabel = 'Count difference';

    var numBins = (max + 1 - min) / binSize;

    // object --> array of binned objects
    // {1: -30, 2: 20, 3: -100, 4: 0} --> [{bin: 0, diff: -30}, {bin: 2, diff: -80}, {bin: 4, diff:0}]
    var histData = [];
    var currentBin = min;

    for (var binNum = 0; binNum < numBins; binNum++) {
        var binDiffCount = 0;

        for (var i = currentBin; i < currentBin + binSize; i++) {
            if (data[i] != undefined) {
                binDiffCount += data[i];
            }
        }

        histData.push({bin: currentBin, diff: binDiffCount});
        currentBin += binSize;
    }

    var diffExtent = d3.extent(histData, function(d) { return d.diff; });
    var minDiff = diffExtent[0];
    var maxDiff = diffExtent[1];

    console.log(histData);


    // This scale is for determining the widths of the histogram bars
    // Must start at 0 or else x (bin size a.k.a dx) will be negative

    // Scale for the placement of the bars
    var xPositionScale = d3.scale.linear()
        .domain([min, max])
        .range([outerMargin.left, innerWidth]);

    var yScale = d3.scale.linear()
        .domain([minDiff, maxDiff])
        .range([innerHeight, outerMargin.top]);

    var xAxis = d3.svg.axis()
        .scale(xPositionScale)
        .orient("bottom");

    var yAxis = d3.svg.axis()
        .scale(yScale)
        .orient("left");

    var svg = d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height)
        .append("g")
        .attr('width', innerWidth)
        .attr('height', innerHeight)
        .attr("transform", "translate(" + outerMargin.left + "," + outerMargin.top + ")")

    // Change if we decide to not make all bins the same width
    var renderedBinWidth = Math.abs(xPositionScale(binSize) - xPositionScale(0));
    var bar = svg.selectAll(".bar")
        .data(histData)
        .enter().append("rect")
        .attr("class", function(d) { return d.diff < 0 ? "bar negative" : "bar positive"; })
        .attr('x', function(d) {
            return xPositionScale(d.bin);
        })
        .attr("y", function(d) { return yScale(Math.max(0, d.diff)); })
        .attr('width', renderedBinWidth)
        .attr("height", function(d) { return Math.abs(yScale(d.diff) - yScale(0)); });

    svg.append("line")
        .attr("class", "baseline")
        .attr("y1", yScale(0))
        .attr("y2", yScale(0))
        .attr("x1", outerMargin.left)
        .attr("x2", innerWidth);

    svg.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0, " + (height - outerMargin.bottom) + ")")
        .call(xAxis)
        .append('text')
        .attr('class', 'x-label label')
        .attr('transform', 'translate(' + (innerWidth/2 - outerMargin.left) + ',' + (outerMargin.bottom + axisLabelMargin.x) + ')')
        .text(xLabel);

    svg.append("g")
        .attr("class", "y axis")
        .attr("transform", "translate(" + (outerMargin.left) + ", 0)")
        .call(yAxis)
        .append('text')
        .attr('class', 'y-label label')
        .attr('transform', 'translate(' + -(outerMargin.left + axisLabelMargin.y) +',' + (height/2 + outerMargin.top) + ') rotate(' + (-90) + ')')
        .text(yLabel);

    // Chart title.
    // Example: "Number of conditions"
    svg.append('text')
        .attr("text-anchor", "middle")
        .attr('transform', 'translate(' + (innerWidth/2) + ', ' + chartTitleMargin + ')')
        .text(title);
}

chartSingleGroupCounts(singleGroupData, 'n_conditions');
chartSingleGroupCounts(singleGroupData, 'n_symptoms');
chartSingleGroupCounts(singleGroupData, 'n_treatments');
//chartBetweenGroupCounts(segmentedData[1], 'sex', 'male', 'female');
//chartBetweenGroupCounts(segmentedData[3], 'sex', 'male', 'female');
//chartBetweenGroupCounts(segmentedData[5], 'sex', 'male', 'female');

//chartBetweenGroupCounts(data[1], 'sex', 'female', 'male');
//chartBetweenGroupCounts(data[3], 'sex', 'female', 'male');
//chartBetweenGroupCounts(data[5], 'sex', 'female', 'male');